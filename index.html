<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ PDF ‡¶∞‡¶ø‡¶°‡¶æ‡¶∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <style>
        @keyframes flip {
            0% { transform: perspective(1000px) rotateY(0deg); }
            50% { transform: perspective(1000px) rotateY(90deg); }
            100% { transform: perspective(1000px) rotateY(0deg); }
        }
        .animate-flip { animation: flip 0.6s ease-in-out; }
        
        .pdf-iframe {
            width: 100%;
            height: calc(100vh - 200px);
            border: none;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Simple icon components
        const Icon = {
            BookOpen: (size = 24) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
            Home: (size = 24) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>`,
            Plus: (size = 24) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
            Menu: (size = 24) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>`,
            X: (size = 24) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
            ExternalLink: (size = 24) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>`
        };

        class PDFReaderApp {
            constructor() {
                this.view = 'home';
                this.pdfUrl = '';
                this.savedPDFs = [];
                this.currentPDF = null;
                this.drawerOpen = false;
                this.useIframe = false;
                
                this.init();
            }

            init() {
                const stored = localStorage.getItem('pdfLibrary');
                if (stored) {
                    this.savedPDFs = JSON.parse(stored);
                }
                this.render();
            }

            extractFileId(url) {
                // Extract file ID from various Google Drive URL formats
                const patterns = [
                    /\/file\/d\/([a-zA-Z0-9_-]+)/,
                    /id=([a-zA-Z0-9_-]+)/,
                    /\/d\/([a-zA-Z0-9_-]+)/
                ];
                
                for (const pattern of patterns) {
                    const match = url.match(pattern);
                    if (match) return match[1];
                }
                return null;
            }

            convertToViewerUrl(url) {
                // Check if it's a Google Drive link
                if (url.includes('drive.google.com')) {
                    const fileId = this.extractFileId(url);
                    if (fileId) {
                        // Use Google Drive's embedded viewer
                        return `https://drive.google.com/file/d/${fileId}/preview`;
                    }
                }
                
                // For other PDFs, use Google Docs Viewer as fallback
                return `https://docs.google.com/viewer?url=${encodeURIComponent(url)}&embedded=true`;
            }

            async loadPDF(url, originalUrl = null) {
                try {
                    this.useIframe = url.includes('drive.google.com') || url.includes('docs.google.com');
                    
                    const viewerUrl = this.convertToViewerUrl(url);
                    
                    const existingPDF = this.savedPDFs.find(p => p.originalUrl === (originalUrl || url));
                    
                    if (!existingPDF) {
                        const newPDF = {
                            id: Date.now(),
                            url: viewerUrl,
                            originalUrl: originalUrl || url,
                            title: `PDF ${this.savedPDFs.length + 1}`,
                            addedDate: new Date().toISOString(),
                            isDrive: url.includes('drive.google.com')
                        };
                        
                        this.savedPDFs.push(newPDF);
                        localStorage.setItem('pdfLibrary', JSON.stringify(this.savedPDFs));
                        this.currentPDF = newPDF;
                    } else {
                        this.currentPDF = existingPDF;
                    }
                    
                    this.view = 'reader';
                    this.render();
                } catch (error) {
                    alert('PDF ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§\n\n‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®:\n‡ßß. Google Drive ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ "Anyone with the link" ‡¶Ü‡¶õ‡ßá\n‡ß®. PDF ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá');
                    console.error(error);
                }
            }

            openExistingPDF(pdf) {
                this.currentPDF = pdf;
                this.useIframe = pdf.isDrive || pdf.url.includes('drive.google.com');
                this.view = 'reader';
                this.drawerOpen = false;
                this.render();
            }

            handleAddPDF() {
                if (this.pdfUrl.trim()) {
                    this.loadPDF(this.pdfUrl.trim());
                    this.pdfUrl = '';
                }
            }

            deletePDF(id) {
                if (confirm('‡¶è‡¶á PDF ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?')) {
                    this.savedPDFs = this.savedPDFs.filter(pdf => pdf.id !== id);
                    localStorage.setItem('pdfLibrary', JSON.stringify(this.savedPDFs));
                    this.render();
                }
            }

            openInNewTab() {
                if (this.currentPDF && this.currentPDF.originalUrl) {
                    window.open(this.currentPDF.originalUrl, '_blank');
                }
            }

            render() {
                const root = document.getElementById('root');
                root.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-orange-600 to-red-600 text-white p-4 shadow-lg">
                            <div class="max-w-7xl mx-auto flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <button onclick="app.drawerOpen = !app.drawerOpen; app.render();" class="p-2 hover:bg-white/20 rounded-lg transition-all">
                                        ${Icon.Menu(24)}
                                    </button>
                                    ${Icon.BookOpen(32)}
                                    <h1 class="text-xl md:text-2xl font-bold">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ PDF ‡¶∞‡¶ø‡¶°‡¶æ‡¶∞</h1>
                                </div>
                                ${this.view === 'reader' ? `
                                <div class="flex items-center gap-2">
                                    <button onclick="app.openInNewTab()" class="p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-all" title="‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®">
                                        ${Icon.ExternalLink(20)}
                                    </button>
                                    <button onclick="app.view = 'home'; app.render();" class="flex items-center gap-2 bg-white/20 px-3 py-2 rounded-lg hover:bg-white/30 transition-all">
                                        ${Icon.Home(20)}
                                        <span class="hidden md:inline">‡¶π‡ßã‡¶Æ</span>
                                    </button>
                                </div>` : ''}
                            </div>
                        </div>

                        <!-- Drawer -->
                        <div class="fixed inset-y-0 left-0 w-80 bg-white shadow-2xl transform transition-transform duration-300 z-50 ${this.drawerOpen ? 'translate-x-0' : '-translate-x-full'}">
                            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                                <h2 class="text-xl font-bold text-gray-800">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø</h2>
                                <button onclick="app.drawerOpen = false; app.render();" class="p-2 hover:bg-gray-100 rounded">
                                    ${Icon.X(24)}
                                </button>
                            </div>
                            <div class="p-4 overflow-y-auto h-full pb-20">
                                ${this.savedPDFs.length === 0 ? 
                                    '<p class="text-gray-500 text-center mt-10">‡¶ï‡ßã‡¶®‡ßã PDF ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶®‡ßá‡¶á</p>' :
                                    `<div class="grid grid-cols-2 gap-4">
                                        ${this.savedPDFs.map(pdf => `
                                            <div class="relative group">
                                                <div onclick='app.openExistingPDF(${JSON.stringify(pdf).replace(/'/g, "\\'")}); event.stopPropagation();' class="cursor-pointer">
                                                    <div class="aspect-[3/4] bg-gradient-to-br from-orange-100 to-red-100 rounded-lg shadow-md group-hover:shadow-xl transition-all border-2 border-orange-200 flex items-center justify-center relative">
                                                        ${Icon.BookOpen(48)}
                                                        ${pdf.isDrive ? '<span class="absolute bottom-2 right-2 text-xs bg-white px-2 py-1 rounded">Drive</span>' : ''}
                                                    </div>
                                                    <p class="mt-2 text-sm font-medium text-gray-700 truncate">${pdf.title}</p>
                                                    <p class="text-xs text-gray-500">${new Date(pdf.addedDate).toLocaleDateString('bn-BD')}</p>
                                                </div>
                                                <button onclick="event.stopPropagation(); app.deletePDF(${pdf.id});" class="absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-lg leading-none">√ó</button>
                                            </div>
                                        `).join('')}
                                    </div>`
                                }
                            </div>
                        </div>

                        <!-- Overlay -->
                        ${this.drawerOpen ? '<div onclick="app.drawerOpen = false; app.render();" class="fixed inset-0 bg-black/50 z-40"></div>' : ''}

                        <!-- Main Content -->
                        <div class="max-w-7xl mx-auto p-4 md:p-6">
                            ${this.view === 'home' ? this.renderHome() : this.renderReader()}
                        </div>
                    </div>
                `;
            }

            renderHome() {
                return `
                    <div class="max-w-2xl mx-auto">
                        <div class="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mt-10">
                            <div class="text-center mb-8">
                                <div class="inline-block p-4 bg-gradient-to-br from-orange-500 to-red-500 rounded-full mb-4">
                                    ${Icon.BookOpen(48)}
                                </div>
                                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">‡¶®‡¶§‡ßÅ‡¶® PDF ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                                <p class="text-gray-600">Google Drive ‡¶¨‡¶æ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã PDF ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶®</p>
                            </div>
                            
                            <div class="space-y-4">
                                <input
                                    id="pdfUrlInput"
                                    type="text"
                                    value="${this.pdfUrl}"
                                    placeholder="PDF ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none text-base md:text-lg"
                                    onkeypress="if(event.key === 'Enter') app.handleAddPDF()"
                                    oninput="app.pdfUrl = this.value"
                                />
                                <button
                                    onclick="app.handleAddPDF()"
                                    class="w-full bg-gradient-to-r from-orange-600 to-red-600 text-white py-3 rounded-lg font-bold text-lg hover:from-orange-700 hover:to-red-700 transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
                                >
                                    ${Icon.Plus(24)}
                                    PDF ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®
                                </button>
                            </div>

                            <div class="mt-8 p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border-2 border-amber-200">
                                <p class="text-sm text-amber-900 leading-relaxed">
                                    <strong>üìö Google Drive ‡¶ü‡¶ø‡¶™‡¶∏:</strong><br><br>
                                    <span class="inline-block mb-1">‡ßß. PDF Upload ‡¶ï‡¶∞‡ßÅ‡¶® Drive ‡¶è</span><br>
                                    <span class="inline-block mb-1">‡ß®. Share ‚Üí <strong>"Anyone with the link"</strong></span><br>
                                    <span class="inline-block mb-1">‡ß©. ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</span><br><br>
                                    <span class="text-green-700">‚úÖ ‡¶∏‡¶¨ ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ Drive ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá!</span>
                                </p>
                            </div>

                            <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <p class="text-sm text-blue-800">
                                    <strong>üîó ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï:</strong><br>
                                    <code class="text-xs break-all">https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf</code>
                                </p>
                            </div>
                        </div>

                        ${this.savedPDFs.length > 0 ? `
                        <div class="mt-10">
                            <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                                ${Icon.BookOpen(24)}
                                ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ PDF ‡¶∏‡¶Æ‡ßÇ‡¶π (${this.savedPDFs.length})
                            </h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                                ${this.savedPDFs.map(pdf => `
                                    <div onclick='app.openExistingPDF(${JSON.stringify(pdf).replace(/'/g, "\\'")}); event.stopPropagation();' class="cursor-pointer group">
                                        <div class="aspect-[3/4] bg-gradient-to-br from-orange-100 to-red-100 rounded-xl shadow-lg group-hover:shadow-2xl transition-all border-2 border-orange-200 group-hover:border-orange-400 flex items-center justify-center transform group-hover:scale-105 relative">
                                            ${Icon.BookOpen(48)}
                                            ${pdf.isDrive ? '<span class="absolute top-2 left-2 text-xs bg-white px-2 py-1 rounded shadow">üìÅ Drive</span>' : ''}
                                        </div>
                                        <p class="mt-3 text-center font-medium text-gray-700 truncate px-2">${pdf.title}</p>
                                        <p class="text-xs text-center text-gray-500">${new Date(pdf.addedDate).toLocaleDateString('bn-BD')}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>` : ''}
                    </div>
                `;
            }

            renderReader() {
                return `
                    <div class="bg-white rounded-xl md:rounded-2xl shadow-2xl p-3 md:p-6">
                        <div class="mb-4">
                            <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-2">${this.currentPDF.title}</h3>
                            <p class="text-xs md:text-sm text-gray-600">
                                ${this.currentPDF.isDrive ? 'üìÅ Google Drive PDF' : 'üîó External PDF'}
                            </p>
                        </div>

                        <div class="relative bg-gray-100 rounded-lg overflow-hidden" style="height: calc(100vh - 220px);">
                            <iframe 
                                src="${this.currentPDF.url}" 
                                class="pdf-iframe"
                                allow="autoplay"
                            ></iframe>
                        </div>

                        <div class="mt-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
                            <p class="text-xs md:text-sm text-amber-800 text-center">
                                üí° <strong>‡¶ü‡¶ø‡¶™‡¶∏:</strong> ‡¶™‡ßá‡¶ú ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá PDF ‡¶è‡¶∞ ‡¶®‡¶ø‡¶ú‡¶∏‡ßç‡¶¨ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
                            </p>
                        </div>
                    </div>
                `;
            }
        }

        // Initialize app
        const app = new PDFReaderApp();
    </script>
</body>
</html>
